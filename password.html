<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MemoQuest 密碼輸入</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .keypad-button {
      text-shadow: 0 0 5px #00AAFF, 0 0 10px #00AAFF;
      box-shadow: 0 0 2px #00AAFF, inset 0 0 2px #00AAFF;
      font-size: 1.25rem;
      font-weight: bold;
      color: white;
      background-color: #0066CC;
      border: 2px solid #00AAFF;
      border-radius: 0.5rem;
    }
    .display-digit {
      font-family: 'monospace';
      color: #00AAFF;
      text-shadow: 0 0 5px #00AAFF;
    }
  </style>
</head>
<body class="flex justify-center items-center min-h-screen bg-gray-900">
  <div class="relative w-[320px] h-[600px] bg-[#2A2A25] rounded-[40px] overflow-hidden shadow-2xl">
    
    <!-- 顯示輸入的密碼 -->
    <div class="mt-[60px] flex justify-center space-x-2">
      <div id="digit-1" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-2" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-3" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-4" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
    </div>

    <!-- 鍵盤 -->
    <div class="mt-6 flex justify-center">
      <div class="w-[220px] h-[280px] bg-[#3A3A35] rounded-lg p-4 grid grid-cols-3 gap-3">
        <button class="keypad-button" data-value="1">1</button>
        <button class="keypad-button" data-value="2">2</button>
        <button class="keypad-button" data-value="3">3</button>
        <button class="keypad-button" data-value="4">4</button>
        <button class="keypad-button" data-value="5">5</button>
        <button class="keypad-button" data-value="6">6</button>
        <button class="keypad-button" data-value="7">7</button>
        <button class="keypad-button" data-value="8">8</button>
        <button class="keypad-button" data-value="9">9</button>
        <button class="keypad-button" data-value="*">*</button>
        <button class="keypad-button" data-value="0">0</button>
        <button class="keypad-button" data-value="#">#</button>
      </div>
    </div>

    <!-- LOGO -->
    <div class="absolute bottom-6 w-full flex justify-center">
      <img src="IMG_4112.png" alt="MemoQuest Logo" class="w-40" />
    </div>
  </div>

  <!-- 控制邏輯 -->
  <script>
    const correctPassword = "2580";
    let currentPosition = 0;
    const displayDigits = [
      document.getElementById('digit-1'),
      document.getElementById('digit-2'),
      document.getElementById('digit-3'),
      document.getElementById('digit-4')
    ];

    document.querySelectorAll('.keypad-button').forEach(button => {
      button.addEventListener('click', () => {
        const value = button.getAttribute('data-value');
        if (value === '#') {
          clearDisplay();
        } else if (!isNaN(parseInt(value)) || value === '*') {
          updateDisplay(value);
        }
      });
    });

    function updateDisplay(value) {
      if (currentPosition >= displayDigits.length) clearDisplay();

      displayDigits[currentPosition].innerHTML = value;
      displayDigits[currentPosition].style.height = '30px';
      currentPosition++;

      if (currentPosition >= displayDigits.length) {
        const entered = displayDigits.map(d => d.innerHTML).join("");
        if (entered === correctPassword) {
          // ✅ 發送給 ESP32
          fetch("http://192.168.50.250/unlock")
            .then(() => {
              // ✅ 跳轉下一頁
              setTimeout(() => {
                window.location.href = "next.html";
              }, 500);
            })
            .catch(() => {
              alert("⚠️ 無法連接設備（ESP32）");
              clearDisplay();
            });
        } else {
          alert("❌ 密碼錯誤");
          setTimeout(clearDisplay, 300);
        }
      }
    }

    function clearDisplay() {
      displayDigits.forEach(d => {
        d.innerHTML = '';
        d.style.height = '6px';
      });
      currentPosition = 0;
    }
  </script>
</body>
</html>


