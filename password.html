<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MemoQuest 密碼輸入</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .keypad-button {
      text-shadow: 0 0 5px #00AAFF, 0 0 10px #00AAFF;
      box-shadow: 0 0 2px #00AAFF, inset 0 0 2px #00AAFF;
    }
    .display-digit {
      font-family: 'monospace';
      color: #00AAFF;
      text-shadow: 0 0 5px #00AAFF;
    }
  </style>
</head>
<body class="flex justify-center items-center min-h-screen bg-gray-900">
  <div class="relative w-[320px] h-[600px] bg-[#2A2A25] rounded-[40px] overflow-hidden shadow-2xl">
    
    <!-- 密碼顯示欄 -->
    <div class="mt-[60px] flex justify-center space-x-2">
      <div id="digit-1" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-2" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-3" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
      <div id="digit-4" class="w-[60px] h-[6px] bg-gray-500 rounded display-digit flex items-center justify-center"></div>
    </div>

    <!-- 數字鍵盤 -->
    <div class="mt-6 flex justify-center">
      <div class="w-[220px] h-[280px] bg-[#3A3A35] rounded-lg p-4">
        <div class="grid grid-cols-3 gap-3">
          ${[1,2,3,4,5,6,7,8,9,'*',0,'#'].map(v => `
            <button class="keypad-button h-12 bg-[#0066CC] border-2 border-[#00AAFF] rounded text-white font-bold text-xl" data-value="${v}">${v}</button>
          `).join('')}
        </div>
      </div>
    </div>

    <!-- LOGO -->
    <div class="absolute bottom-6 w-full flex justify-center">
      <img src="IMG_4112.png" alt="MemoQuest Logo" class="w-40" />
    </div>
  </div>

  <!-- 控制程式 -->
  <script>
    const correctPassword = "2580";
    let currentPosition = 0;
    const displayDigits = [
      document.getElementById('digit-1'),
      document.getElementById('digit-2'),
      document.getElementById('digit-3'),
      document.getElementById('digit-4')
    ];

    document.querySelectorAll('.keypad-button').forEach(button => {
      button.addEventListener('click', () => {
        const value = button.getAttribute('data-value');
        if (value === '#') {
          clearDisplay();
        } else if (!isNaN(parseInt(value)) || value === '*') {
          updateDisplay(value);
        }
      });
    });

    function updateDisplay(value) {
      if (currentPosition >= displayDigits.length) clearDisplay();

      displayDigits[currentPosition].innerHTML = value;
      displayDigits[currentPosition].style.height = '30px';
      currentPosition++;

      if (currentPosition >= displayDigits.length) {
        const entered = displayDigits.map(d => d.innerHTML).join("");
        if (entered === correctPassword) {
          // ✅ 呼叫你的 ESP32 IP 來控制舵機
          fetch("http://192.168.50.250/unlock")
            .then(res => console.log("ESP32 回應成功:", res.status))
            .catch(err => console.error("ESP32 錯誤:", err));

          // ✅ 跳轉到下一頁
          setTimeout(() => {
            window.location.href = "next.html";
          }, 1000);
        } else {
          alert("密碼錯誤");
          setTimeout(clearDisplay, 300);
        }
      }
    }

    function clearDisplay() {
      displayDigits.forEach(d => {
        d.innerHTML = '';
        d.style.height = '6px';
      });
      currentPosition = 0;
    }
  </script>
</body>
</html>


